<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="spark8,Spark8,Spark2.0,spark2.0"><title>日志监控告警系统（一） | Spark8</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">日志监控告警系统（一）</h1><a id="logo" href="/.">Spark8</a><p class="description">Do something you want,Be someone you like!</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">日志监控告警系统（一）</h1><div class="post-meta">May 17, 2016<span> | </span><span class="category"><a href="/categories/storm/">storm</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/05/17/实时日志监控系统(一)/" href="/2016/05/17/实时日志监控系统(一)/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><a id="more"></a>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>随着公司业务发展，支撑公司业务的各种系统越来越多，为了保证公司的业务正常发展，急需要对这些线上系统的运行进行监控，做到问题的及时发现和处理，最大程度减少对业务的影响。<br>目前系统分类有：<br>1)    有基于Tomcat的web应用<br>2)    有独立的Java Application应用<br>3)    有运行在linux上的脚本程序<br>4)    有大规模的集群框架（zookeeper、Hadoop、Storm…）<br>5)    有操作系统的运行日志<br>主要功能需求分为：<br>监控系统日志中的内容，按照一定规则进行过滤<br>发现问题之后通过短信和邮件进行告警</p>
<h2 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h2><p>数据输入<br>使用flume客户端获取个系统的数据；<br>用户通过页面输入系统名称、负责人触发规则等信息<br>数据存储<br>使用flume采集数据并存放在kafka集群中<br>数据计算<br>使用storm编写程序对日志进行过滤，将满足过滤规则的信息，通过邮件短信告警并保存到数据库中<br>数据展示<br>管理页面可以查看触发规则的信息，系统负责人，联系方式，触发信息明细等</p>
<h2 id="原型设计"><a href="#原型设计" class="headerlink" title="原型设计"></a>原型设计</h2><p>产品经理设计原型</p>
<h1 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h1><h3 id="整体架构设计"><a href="#整体架构设计" class="headerlink" title="整体架构设计"></a>整体架构设计</h3><p><img src="/images/DraggedImage.png" alt="整体架构"><br><img src="/images/ztlc.png" alt="整体流程图" title="整体流程图"><br>主要架构为应用+flume+kafka+storm+mysql+Java web。数据流程如下：</p>
<ol>
<li>应用程序使用log4j产生日志</li>
<li>部署flume客户端监控应用程序产生的日志信息，并发送到kafka集群中</li>
<li>storm spout拉去kafka的数据进行消费，逐条过滤每条日志的进行规则判断，对符合规则的日志进行邮件告警。</li>
<li>最后将告警的信息保存到mysql数据库中，用来进行管理。<h3 id="Flume设计"><a href="#Flume设计" class="headerlink" title="Flume设计"></a>Flume设计</h3>Flume说明<br>Flume是一个分布式、可靠地、可用的服务，用来收集、聚合、传输日志数据。<br>它是一个基于流式数据的架构，简单而灵活。具有健壮性、容错机制、故障转移、恢复机制。<br>它提供一个简单的可扩展的数据模型，容许在线分析程序。F<br>Flume 作为 cloudera 开发的实时日志收集系统，受到了业界的认可与广泛应用。<br>Flume 设计摘要<br>使用 Flume EXEC执行一个linux命令来生成数据源。例如，可以用tail命令监控一个文件，那么，只要文件增加内容，EXEC就可以将增加的内容作为数据源发送出去。<br>使用 org.apache.flume.plugins.KafkaSink，将Flume EXEC产生的数据源发送到Kafka中。<h3 id="Kafka设计"><a href="#Kafka设计" class="headerlink" title="Kafka设计"></a>Kafka设计</h3>Kafka说明<br>kafka是一个分布式消息队列：生产者、消费者的功能。<br>Kakfa设计摘要<br>部署kafka集群，在集群中添加一个Topic：monitor_realtime_javaxy<h3 id="Storm设计"><a href="#Storm设计" class="headerlink" title="Storm设计"></a>Storm设计</h3>KafkaSpout读取数据，需要配置Topic：monitor_realtime_javaxy<br>FilterBolt判断规则<br>NotifyBolt用来发送邮件或短信息<br>Save2DB用来将告警信息写入mysql数据库<h3 id="数据模型设计"><a href="#数据模型设计" class="headerlink" title="数据模型设计"></a>数据模型设计</h3><h4 id="用户表"><a href="#用户表" class="headerlink" title="用户表"></a>用户表</h4>用来保存用户的信息，包括账号、手机号码、邮箱、是否有效等信息。各字段请参加<a href="github">github</a>具体bean(comment截屏不便)<br><img src="/images/log_monitor_user.png" alt="log_monitor_user" title="log_monitor_user"><h4 id="应用表"><a href="#应用表" class="headerlink" title="应用表"></a>应用表</h4>用来保存应用的信息，包括应用名称、应用描述、应用是否在线等信息。<br><img src="/images/log_monitor_app.png" alt="log_monitor_app" title="log_monitor_app"><h4 id="应用类型表"><a href="#应用类型表" class="headerlink" title="应用类型表"></a>应用类型表</h4>用来保存应用的类型等信息。<br><img src="/images/log_monitor_app_type.png" alt="log_monitor_app\_type" title="log_monitor_app_type"><h4 id="规则表"><a href="#规则表" class="headerlink" title="规则表"></a>规则表</h4>用来保存规则的信息，包括规则名称，规则描述，规则关键词等信息。<br><img src="/images/log_monitor_rule.png" alt="log_monitor_rule" title="log_monitor_rule"><h4 id="规则记录表"><a href="#规则记录表" class="headerlink" title="规则记录表"></a>规则记录表</h4>用来保存触发规则后的记录，包括告警编号、是否短信告知、是否邮件告知、告警明细等信息。<br><img src="/images/log_monitor_rule_record.png" alt="log_monitor_rule_record" title="log_monitor_rule_record"><h2 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h2><h3 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h3><img src="/images/ssgc.png" alt="工程结构" title="工程结构"><h4 id="LogMonitorTopologyMain驱动类"><a href="#LogMonitorTopologyMain驱动类" class="headerlink" title="LogMonitorTopologyMain驱动类"></a>LogMonitorTopologyMain驱动类</h4><img src="/images/logmtm.png" alt=""><h4 id="KafkaSpout获取数据源"><a href="#KafkaSpout获取数据源" class="headerlink" title="KafkaSpout获取数据源"></a>KafkaSpout获取数据源</h4><img src="/images/kafkasp.png" alt=""><h4 id="FilterBolt过滤日志信息"><a href="#FilterBolt过滤日志信息" class="headerlink" title="FilterBolt过滤日志信息"></a>FilterBolt过滤日志信息</h4><img src="/images/filb.png" alt=""><h4 id="PrepareRecordBolt发送邮件告警和短信告警"><a href="#PrepareRecordBolt发送邮件告警和短信告警" class="headerlink" title="PrepareRecordBolt发送邮件告警和短信告警"></a>PrepareRecordBolt发送邮件告警和短信告警</h4><img src="/images/prep.png" alt=""><h4 id="SaveMessage2MySq保存到数据库"><a href="#SaveMessage2MySq保存到数据库" class="headerlink" title="SaveMessage2MySq保存到数据库"></a>SaveMessage2MySq保存到数据库</h4><img src="/images/s2m.png" alt=""></li>
</ol>
</div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a data-url="http://spark8.tech/2016/05/17/实时日志监控系统(一)/" data-id="cipo8i7ne00096vfyw0fgf5fn" class="article-share-link">分享到</a><div class="tags"><a href="/tags/storm/">storm</a><a href="/tags/kafka/">kafka</a><a href="/tags/mysql/">mysql</a></div><div class="post-nav"><a href="/2016/05/17/Shell编程——使用Shell上传数据到HDFS/" class="next">Shell编程——使用HDFS Shell上传文件</a></div><div id="disqus_thread"><script>var disqus_shortname = 'sparkliwei';
var disqus_identifier = '2016/05/17/实时日志监控系统(一)/';
var disqus_title = '日志监控告警系统（一）';
var disqus_url = 'http://spark8.tech/2016/05/17/实时日志监控系统(一)/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//sparkliwei.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm/">storm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Shell脚本/" style="font-size: 15px;">Shell脚本</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/storm/" style="font-size: 15px;">storm</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/RPC/" style="font-size: 15px;">RPC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/17/实时日志监控系统(一)/">日志监控告警系统（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/17/Shell编程——使用Shell上传数据到HDFS/">Shell编程——使用HDFS Shell上传文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/16/Linux——三种网络连接方式/">Linux——网络连接三种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/15/Shell编程——自动化软件部署/">Shell编程——自动化软件部署脚本</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/12/轻量级RPC框架(二)/">轻量级RPC框架（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/12/轻量级RPC框架(一)/">轻量级RPC框架（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/14/redis_sortedSet/">Redis应用-LOL盒子英雄数据排行榜</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//sparkliwei.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://spark8.tech/" title="spark8" target="_blank">spark8</a><ul></ul><a href="https://github.com/sparkLiwei" title="github" target="_blank">github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Spark8.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.1"><script type="text/javascript" src="/js/search.js?v=0.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?561e14522c8f418b3f35a30cba92c642";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
     bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
     bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  s.parentNode.insertBefore(bp, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>